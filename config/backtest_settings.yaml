# Backtesting Configuration

backtest:
  # Date range for backtesting
  # Extended to 10 years: covers bull market, COVID crash, meme stocks, bear market, recovery
  start_date: "2015-01-01"
  end_date: "2025-12-10"  # Updated to yesterday
  
  # Split for training vs out-of-sample testing
  # Train: 2015-2021 | Test: 2022-2024
  train_end_date: "2021-12-31"
  
  # Initial capital
  initial_cash: 100000.0
  
  # Benchmark for comparison
  benchmark_ticker: "SPY"

# Transaction cost settings
costs:
  # Slippage in basis points (10 bps = 0.1% - realistic for mid-caps)
  slippage_bps: 10.0
  
  # Commission per share (most brokers now $0)
  commission_per_share: 0.0
  
  # Minimum commission per trade
  min_commission: 0.0
  
  # Market impact settings
  market_impact_enabled: true
  market_impact_coefficient: 0.1
  adv_threshold: 0.005  # 0.5% of ADV triggers impact

# Risk management during backtest
risk:
  max_position_pct: 0.15      # Max 15% per position
  max_sector_pct: 0.30        # Max 30% per sector (reduced from 40%)
  min_cash_buffer: 200.0      # Reserve cash (increased from 100)
  volatility_lookback: 30     # Days for volatility calculation
  
  # Phase 7: Stop-loss and drawdown controls
  # A/B tested with diverse stocks (banks, energy, cyclicals, value traps)
  # 15% = balanced default: protects capital without cutting winners too early
  stop_loss_pct: 0.15         # Sell if position drops 15% from entry
  drawdown_warning: 0.15      # Reduce positions 50% at -15% drawdown
  drawdown_halt: 0.20         # No new buys at -20% drawdown
  drawdown_liquidate: 0.25    # Emergency liquidation at -25% drawdown
  use_stop_loss: false        # Disabled for A/B comparison
  use_drawdown_control: true  # Enable portfolio drawdown control

# Execution settings
execution:
  # How often to rebalance: daily, weekly, monthly
  rebalance_frequency: "daily"
  
  # Use risk manager for position sizing
  use_risk_manager: true

# Performance analysis settings
performance:
  # Risk-free rate for Sharpe calculation
  risk_free_rate: 0.04  # 4% (current environment)
  
  # Trading days per year
  trading_days: 252

# Regime classification settings
regimes:
  sma_period: 200           # SMA for trend detection
  volatility_lookback: 30    # Days for volatility
  
  # Volatility thresholds
  crisis_vol_mult: 2.0       # Crisis if vol > 2x average
  high_vol_mult: 1.5         # High vol threshold

# Output settings
output:
  save_trades: true
  save_metrics_json: true
  save_summary_txt: true
  # Use dated subdirectories for backtest archives
  # Latest backtest is symlinked to results/ root for dashboard access
  output_dir: "results/backtests"
  use_dated_folders: true  # Creates results/backtests/YYYY-MM-DD/

